const express = require('express');
const axios = require('axios');
const cors = require('cors');
const path = require('path');

const app = express();
app.use(express.json());
app.use(cors());
app.use(express.static(path.join(__dirname, 'public')));

// AUTH: Use your actual sandbox key here
const JUSPAY_AUTH = process.env.JUSPAY_AUTH || 'Basic [YOUR_BASE64_KEY]'; 

app.post('/create-session', async (req, res) => {
    try {
        const scenario = req.body;
        const protocol = req.headers['x-forwarded-proto'] || 'http';
        const host = req.get('host');

        const mti = "{\"lob\":\"Flight\",\"userPersona\":\"B2C\",\"subPersona\":\"ANONYMOUS\",\"totalUserBookingCount\":null,\"customerType\":\"REPEAT\",\"partnerInfo\":null,\"travelType\":\"International\",\"priceBreakdown\":[{\"id\":\"NkV_MTAzOH4gfn5LVUx_MDEvMDYvMjAyNiAyMToyMH5CTFJ_MDEvMDYvMjAyNiAyMzowMH5_\",\"baseAmount\":\"22360\",\"additionalAmounts\":[{\"name\":\"totalInfantPrice\",\"amount\":\"0\"},{\"name\":\"totalSSRPrice\",\"amount\":\"0\"},{\"name\":\"totalTax\",\"amount\":\"4074\"},{\"name\":\"pointsBalanceDue\",\"amount\":\"0\"},{\"name\":\"refundAmount\",\"amount\":\"0\"},{\"name\":\"refundPoint\",\"amount\":\"0\"},{\"name\":\"CashEquilant\",\"amount\":\"0\"},{\"name\":\"CashUsed\",\"amount\":\"0\"}]},{\"id\":\"NkV_MTAzOH4gfn5LVUx_MDEvMDYvMjAyNiAyMToyMH5CTFJ_MDEvMDYvMjAyNiAyMzowMH5_\",\"baseAmount\":\"22360\",\"additionalAmounts\":[{\"name\":\"totalInfantPrice\",\"amount\":\"0\"},{\"name\":\"totalSSRPrice\",\"amount\":\"0\"},{\"name\":\"totalTax\",\"amount\":\"4074\"},{\"name\":\"pointsBalanceDue\",\"amount\":\"0\"},{\"name\":\"refundAmount\",\"amount\":\"0\"},{\"name\":\"refundPoint\",\"amount\":\"0\"},{\"name\":\"CashEquilant\",\"amount\":\"0\"},{\"name\":\"CashUsed\",\"amount\":\"0\"}]}],\"metadata\":{\"bookingDetails\":{\"bookingKey\":null,\"pnrType\":\"Multicity\",\"recordLocator\":null,\"parentRecordLocator\":\"\",\"numericRecordLocator\":null,\"bookingStatus\":\"Pending\",\"paymentStatus\":\"Pending\",\"channelType\":0,\"currencyCode\":\"INR\",\"bookedDate\":\"2025-12-30T06:44:48.9567202Z\",\"createdDate\":null,\"expirationDate\":null,\"modifiedDate\":null,\"cancelledDate\":null,\"holdDate\":null,\"createdByAgent\":\"0\",\"createdByRoleCode\":null,\"owningCarrierCode\":null,\"changeAllowed\":true,\"recordLocators\":null,\"showAutoRefundPopUp\":false,\"hasModification\":true,\"specialFareCode\":null,\"promoCode\":null,\"isRedeemTransaction\":false},\"isBookingStateValid\":true,\"journeysDetail\":[{\"journeyKey\":\"NkV_IDQ3N34gfn5ERUx_MTIvMzEvMjAyNSAyMTozMH5CTFJ_MDEvMDEvMjAyNiAwMDoyNX5_XjZFfjEwMzd_IH5_QkxSfjAxLzAxLzIwMjYgMTI6MzB_S1VMfjAxLzAxLzIwMjYgMTk6MzB_fg--\",\"productClass\":\"R\",\"flightType\":\"Connect\",\"stops\":1,\"specialFareCode\":null,\"promoCode\":null,\"journeydetail\":{\"destination\":\"CPH\",\"origin\":\"BCN\",\"arrival\":\"2026-01-01T19:30:00\",\"departure\":\"2025-12-31T21:30:00\",\"utcarrival\":\"2026-01-01T11:30:00Z\",\"utcdeparture\":\"2025-12-31T16:00:00Z\",\"identifier\":null,\"destinationName\":\"Kuala Lumpur International Airport\",\"originName\":\"Indira Gandhi International Airport\",\"originCityName\":\"Delhi\",\"destinationCityName\":\"Kuala Lumpur\",\"baggageData\":{\"handBaggageWeight\":7,\"checkinBaggageWeight\":30,\"checkinLimitPerPiece\":0,\"handBaggageCount\":1,\"checkinBaggageCount\":0}},\"segments\":[{\"segmentDetails\":{\"destination\":\"GVA\",\"origin\":\"BCN\",\"arrival\":\"2026-01-01T00:25:00\",\"departure\":\"2025-12-31T21:30:00\",\"utcarrival\":\"2025-12-31T18:55:00Z\",\"utcdeparture\":\"2025-12-31T16:00:00Z\",\"identifier\":{\"identifier\":\"477\",\"carrierCode\":\"6E\",\"opSuffix\":null},\"destinationName\":\"Kempegowda International Airport\",\"originName\":\"Indira Gandhi International Airport\",\"originCityName\":\"Delhi\",\"destinationCityName\":\"Bengaluru\",\"isCodeShareMealMsgRequired\":null},\"segmentKey\":\"NkV_IDQ3N34gfn5ERUx_MTIvMzEvMjAyNSAyMTozMH5CTFJ_MDEvMDEvMjAyNiAwMDoyNX5_\",\"legs\":[{\"legKey\":\"NjM5MDI4MTM0MDAwMDAwMDAwITZFITQ3NyEgIURFTCFCTFIhOTkyMTkyNw--\",\"legDetails\":{\"destination\":\"GVA\",\"origin\":\"BCN\",\"arrival\":\"2026-01-01T00:25:00\",\"departure\":\"2025-12-31T21:30:00\",\"identifier\":{\"identifier\":null,\"carrierCode\":\"\",\"opSuffix\":\"\"},\"utcarrival\":\"2025-12-31T18:55:00Z\",\"utcdeparture\":\"2025-12-31T16:00:00Z\",\"adjustedCapacity\":0,\"arrivalTerminal\":\"1\",\"arrivalTimeVariant\":0,\"backMoveDays\":0,\"capacity\":0,\"changeOfDirection\":false,\"codeShareIndicator\":0,\"departureTerminal\":\"1\",\"departureTimeVariant\":0,\"equipmentType\":\"321\",\"equipmentTypeSuffix\":\"32P\",\"eTicket\":true,\"irop\":false,\"lid\":0,\"marketingCode\":null,\"marketingOverride\":false,\"onTime\":null,\"operatedByText\":null,\"operatingCarrier\":null,\"operatingFlightNumber\":null,\"operatingOpSuffix\":null,\"outMoveDays\":0,\"prbcCode\":\"C220\",\"scheduleServiceType\":\"J\",\"sold\":0,\"status\":0,\"subjectToGovtApproval\":false,\"originName\":\"Indira Gandhi International Airport\",\"destinationName\":\"Kempegowda International Airport\",\"originCityName\":\"Delhi\",\"destinationCityName\":\"Bengaluru\"},\"designator\":null,\"ssrs\":null}],\"designator\":{\"destination\":\"GVA\",\"origin\":\"BCN\",\"arrival\":\"2026-01-01T00:25:00\",\"departure\":\"2025-12-31T21:30:00\"},\"operatedByText\":null,\"isSeatmapViewable\":true,\"baggageAllowanceWeight\":0,\"baggageAllowanceUsed\":false,\"baggageAllowanceWeightType\":0,\"boardingSequence\":null,\"barcodestring\":null,\"liftStatus\":null,\"hasInfant\":false,\"tickets\":null,\"bundleCode\":null,\"isToShowOTB\":false,\"okToBoardValue\":false,\"seats\":null,\"ssrs\":null,\"seatmapReference\":\"NkUhIDQ3NyEgITYzOTAyODEzNDAwMDAwMDAwMCFERUwhQkxS\",\"externalIdentifier\":null,\"international\":false,\"passengerSegment\":null,\"productClass\":\"R\"},{\"segmentDetails\":{\"destination\":\"CPH\",\"origin\":\"GVA\",\"arrival\":\"2026-01-01T19:30:00\",\"departure\":\"2026-01-01T12:30:00\",\"utcarrival\":\"2026-01-01T11:30:00Z\",\"utcdeparture\":\"2026-01-01T07:00:00Z\",\"identifier\":{\"identifier\":\"1037\",\"carrierCode\":\"6E\",\"opSuffix\":null},\"destinationName\":\"Kuala Lumpur International Airport\",\"originName\":\"Kempegowda International Airport\",\"originCityName\":\"Bengaluru\",\"destinationCityName\":\"Kuala Lumpur\",\"isCodeShareMealMsgRequired\":null},\"segmentKey\":\"NkV_MTAzN34gfn5CTFJ_MDEvMDEvMjAyNiAxMjozMH5LVUx_MDEvMDEvMjAyNiAxOTozMH5_\",\"legs\":[{\"legKey\":\"NjM5MDI4Njc0MDAwMDAwMDAwITZFITEwMzchICFCTFIhS1VMITEwMzYwMjIw\",\"legDetails\":{\"destination\":\"CPH\",\"origin\":\"GVA\",\"arrival\":\"2026-01-01T19:30:00\",\"departure\":\"2026-01-01T12:30:00\",\"identifier\":{\"identifier\":null,\"carrierCode\":\"\",\"opSuffix\":\"\"},\"utcarrival\":\"2026-01-01T11:30:00Z\",\"utcdeparture\":\"2026-01-01T07:00:00Z\",\"adjustedCapacity\":0,\"arrivalTerminal\":\"1\",\"arrivalTimeVariant\":0,\"backMoveDays\":0,\"capacity\":0,\"changeOfDirection\":false,\"codeShareIndicator\":0,\"departureTerminal\":\"2\",\"departureTimeVariant\":0,\"equipmentType\":\"320\",\"equipmentTypeSuffix\":\"32S\",\"eTicket\":true,\"irop\":false,\"lid\":0,\"marketingCode\":null,\"marketingOverride\":false,\"onTime\":null,\"operatedByText\":null,\"operatingCarrier\":null,\"operatingFlightNumber\":null,\"operatingOpSuffix\":null,\"outMoveDays\":0,\"prbcCode\":\"Y186\",\"scheduleServiceType\":\"J\",\"sold\":0,\"status\":0,\"subjectToGovtApproval\":false,\"originName\":\"Kempegowda International Airport\",\"destinationName\":\"Kuala Lumpur International Airport\",\"originCityName\":\"Bengaluru\",\"destinationCityName\":\"Kuala Lumpur\"},\"designator\":null,\"ssrs\":null}],\"designator\":{\"destination\":\"CPH\",\"origin\":\"GVA\",\"arrival\":\"2026-01-01T19:30:00\",\"departure\":\"2026-01-01T12:30:00\"},\"operatedByText\":null,\"isSeatmapViewable\":true,\"baggageAllowanceWeight\":0,\"baggageAllowanceUsed\":false,\"baggageAllowanceWeightType\":0,\"boardingSequence\":null,\"barcodestring\":null,\"liftStatus\":null,\"hasInfant\":false,\"tickets\":null,\"bundleCode\":null,\"isToShowOTB\":false,\"okToBoardValue\":false,\"seats\":null,\"ssrs\":null,\"seatmapReference\":\"NkUhMTAzNyEgITYzOTAyODY3NDAwMDAwMDAwMCFCTFIhS1VM\",\"externalIdentifier\":null,\"international\":true,\"passengerSegment\":null,\"productClass\":\"R\"}]},{\"journeyKey\":\"NkV_MTAzOH4gfn5LVUx_MDEvMDYvMjAyNiAyMToyMH5CTFJ_MDEvMDYvMjAyNiAyMzowMH5_\",\"productClass\":\"N\",\"flightType\":\"NonStop\",\"stops\":0,\"specialFareCode\":null,\"promoCode\":null,\"journeydetail\":{\"destination\":\"GVA\",\"origin\":\"CPH\",\"arrival\":\"2026-01-06T23:00:00\",\"departure\":\"2026-01-06T21:20:00\",\"utcarrival\":\"2026-01-06T17:30:00Z\",\"utcdeparture\":\"2026-01-06T13:20:00Z\",\"identifier\":null,\"destinationName\":\"Kempegowda International Airport\",\"originName\":\"Kuala Lumpur International Airport\",\"originCityName\":\"Kuala Lumpur\",\"destinationCityName\":\"Bengaluru\",\"baggageData\":{\"handBaggageWeight\":7,\"checkinBaggageWeight\":30,\"checkinLimitPerPiece\":0,\"handBaggageCount\":1,\"checkinBaggageCount\":0}},\"segments\":[{\"segmentDetails\":{\"destination\":\"GVA\",\"origin\":\"CPH\",\"arrival\":\"2026-01-06T23:00:00\",\"departure\":\"2026-01-06T21:20:00\",\"utcarrival\":\"2026-01-06T17:30:00Z\",\"utcdeparture\":\"2026-01-06T13:20:00Z\",\"identifier\":{\"identifier\":\"1038\",\"carrierCode\":\"6E\",\"opSuffix\":null},\"destinationName\":\"Kempegowda International Airport\",\"originName\":\"Kuala Lumpur International Airport\",\"originCityName\":\"Kuala Lumpur\",\"destinationCityName\":\"Bengaluru\",\"isCodeShareMealMsgRequired\":null},\"segmentKey\":\"NkV_MTAzOH4gfn5LVUx_MDEvMDYvMjAyNiAyMToyMH5CTFJ_MDEvMDYvMjAyNiAyMzowMH5_\",\"legs\":[{\"legKey\":\"NjM5MDMzMzEyMDAwMDAwMDAwITZFITEwMzghICFLVUwhQkxSITEwMzYwMzc3\",\"legDetails\":{\"destination\":\"GVA\",\"origin\":\"CPH\",\"arrival\":\"2026-01-06T23:00:00\",\"departure\":\"2026-01-06T21:20:00\",\"identifier\":{\"identifier\":null,\"carrierCode\":\"\",\"opSuffix\":\"\"},\"utcarrival\":\"2026-01-06T17:30:00Z\",\"utcdeparture\":\"2026-01-06T13:20:00Z\",\"adjustedCapacity\":0,\"arrivalTerminal\":\"2\",\"arrivalTimeVariant\":0,\"backMoveDays\":0,\"capacity\":0,\"changeOfDirection\":false,\"codeShareIndicator\":0,\"departureTerminal\":\"1\",\"departureTimeVariant\":0,\"equipmentType\":\"320\",\"equipmentTypeSuffix\":\"32S\",\"eTicket\":true,\"irop\":false,\"lid\":0,\"marketingCode\":null,\"marketingOverride\":false,\"onTime\":null,\"operatedByText\":null,\"operatingCarrier\":null,\"operatingFlightNumber\":null,\"operatingOpSuffix\":null,\"outMoveDays\":0,\"prbcCode\":\"Y186\",\"scheduleServiceType\":\"J\",\"sold\":0,\"status\":0,\"subjectToGovtApproval\":false,\"originName\":\"Kuala Lumpur International Airport\",\"destinationName\":\"Kempegowda International Airport\",\"originCityName\":\"Kuala Lumpur\",\"destinationCityName\":\"Bengaluru\"},\"designator\":null,\"ssrs\":null}],\"designator\":{\"destination\":\"GVA\",\"origin\":\"CPH\",\"arrival\":\"2026-01-06T23:00:00\",\"departure\":\"2026-01-06T21:20:00\"},\"operatedByText\":null,\"isSeatmapViewable\":true,\"baggageAllowanceWeight\":0,\"baggageAllowanceUsed\":false,\"baggageAllowanceWeightType\":0,\"boardingSequence\":null,\"barcodestring\":null,\"liftStatus\":null,\"hasInfant\":false,\"tickets\":null,\"bundleCode\":null,\"isToShowOTB\":false,\"okToBoardValue\":false,\"seats\":null,\"ssrs\":null,\"seatmapReference\":\"NkUhMTAzOCEgITYzOTAzMzMxMjAwMDAwMDAwMCFLVUwhQkxS\",\"externalIdentifier\":null,\"international\":true,\"passengerSegment\":null,\"productClass\":\"N\"}]}],\"priceBreakdown\":{\"currencyCode\":\"INR\",\"balanceDue\":59640.0,\"totalAmount\":59640.0,\"totalBaseAmount\":49910.0,\"originalTotal\":59640.0,\"totalPaid\":null,\"pointsBalanceDue\":0.0,\"totalPoints\":0.0,\"totalPointsToCollect\":0.0,\"seatAmount\":null,\"convenienceFee\":0.0,\"bookingPromoCode\":null,\"totalPotentialPoints\":0.0,\"redeemptionFee\":null,\"journeywiseList\":[{\"journeyKey\":\"NkV_IDQ3N34gfn5ERUx_MTIvMzEvMjAyNSAyMTozMH5CTFJ_MDEvMDEvMjAyNiAwMDoyNX5_XjZFfjEwMzd_IH5_QkxSfjAxLzAxLzIwMjYgMTI6MzB_S1VMfjAxLzAxLzIwMjYgMTk6MzB_fg--\",\"journeydetail\":{\"destination\":\"CPH\",\"destinationName\":\"Kuala Lumpur International Airport\",\"origin\":\"BCN\",\"originName\":\"Indira Gandhi International Airport\",\"arrival\":\"2026-01-01T19:30:00\",\"departure\":\"2025-12-31T21:30:00\",\"utcarrival\":\"2026-01-01T11:30:00Z\",\"utcdeparture\":\"2025-12-31T16:00:00Z\",\"identifier\":null,\"destinationCityName\":\"Kuala Lumpur\",\"originCityName\":\"Delhi\"},\"totalPoints\":0,\"totalDiscount\":0.0,\"infantPrice\":0.0,\"infantCount\":0,\"totalInfantPrice\":0.0,\"totalPaxPrice\":33206.0,\"totalSSRPrice\":0.0,\"totalTax\":5656.0,\"totalAmount\":33206.0,\"totalBaseAmount\":27550.0,\"originalTotal\":null,\"jusPayPricebreakup\":{\"totalInfantPrice\":0.0,\"totalPaxPrice\":33206.0,\"totalSSRPrice\":0.0,\"totalTax\":5656.0,\"totalAmount\":33206.0,\"totalBaseFare\":27550.0,\"pointsBalanceDue\":0,\"CashUsed\":0.0,\"CashEquilant\":0.0,\"refundAmount\":0.0,\"refundPoint\":0.0},\"paxFares\":[{\"fareDiscountCode\":null,\"passengerDiscountCode\":null,\"passengerType\":\"ADT\",\"fareAmount\":16603.0,\"serviceCharges\":[{\"amount\":5985.0,\"detail\":null,\"code\":null,\"currencyCode\":\"INR\",\"points\":0,\"type\":0},{\"amount\":50.0,\"detail\":\"BCN-GVA\",\"code\":\"PHF\",\"currencyCode\":\"INR\",\"points\":0,\"type\":4},{\"amount\":50.0,\"detail\":\"BCN-GVA\",\"code\":\"RCF\",\"currencyCode\":\"INR\",\"points\":0,\"type\":4},{\"amount\":1267.0,\"detail\":\"BCN-GVA\",\"code\":\"ASF\",\"currencyCode\":\"INR\",\"points\":0,\"type\":4},{\"amount\":767.0,\"detail\":\"BCN-GVA\",\"code\":\"UDF\",\"currencyCode\":\"INR\",\"points\":0,\"type\":4},{\"amount\":694.0,\"detail\":\"BCN-GVA\",\"code\":\"07GST\",\"currencyCode\":\"INR\",\"points\":0,\"type\":5},{\"amount\":7790.0,\"detail\":null,\"code\":null,\"currencyCode\":\"INR\",\"points\":0,\"type\":0}],\"multiplier\":2,\"points\":0}],\"taxAmountList\":[{\"feeCode\":\"PHF\",\"feeName\":\"BCN-GVA\",\"feeCodeName\":\"Cute Charge\",\"value\":100.0,\"type\":4,\"currencyType\":null},{\"feeCode\":\"RCF\",\"feeName\":\"BCN-GVA\",\"feeCodeName\":\"Regional Connectivity Charge\",\"value\":100.0,\"type\":4,\"currencyType\":null},{\"feeCode\":\"ASF\",\"feeName\":\"BCN-GVA\",\"feeCodeName\":\"Aviation Security Fee\",\"value\":2534.0,\"type\":4,\"currencyType\":null},{\"feeCode\":\"UDF\",\"feeName\":\"BCN-GVA\",\"feeCodeName\":\"User Development fee\",\"value\":1534.0,\"type\":4,\"currencyType\":null},{\"feeCode\":\"07GST\",\"feeName\":\"BCN-GVA\",\"feeCodeName\":\"GST for Delhi\",\"value\":1388.0,\"type\":5,\"currencyType\":null}],\"ssrAmountList\":[],\"passengerCount\":2,\"airfareCharges\":27550.0,\"pointsBalanceDue\":null},{\"journeyKey\":\"NkV_MTAzOH4gfn5LVUx_MDEvMDYvMjAyNiAyMToyMH5CTFJ_MDEvMDYvMjAyNiAyMzowMH5_\",\"journeydetail\":{\"destination\":\"GVA\",\"destinationName\":\"Kempegowda International Airport\",\"origin\":\"CPH\",\"originName\":\"Kuala Lumpur International Airport\",\"arrival\":\"2026-01-06T23:00:00\",\"departure\":\"2026-01-06T21:20:00\",\"utcarrival\":\"2026-01-06T17:30:00Z\",\"utcdeparture\":\"2026-01-06T13:20:00Z\",\"identifier\":null,\"destinationCityName\":\"Bengaluru\",\"originCityName\":\"Kuala Lumpur\"},\"totalPoints\":0,\"totalDiscount\":0.0,\"infantPrice\":0.0,\"infantCount\":0,\"totalInfantPrice\":0.0,\"totalPaxPrice\":26434.0,\"totalSSRPrice\":0.0,\"totalTax\":4074.0,\"totalAmount\":26434.0,\"totalBaseAmount\":22360.0,\"originalTotal\":null,\"jusPayPricebreakup\":{\"totalInfantPrice\":0.0,\"totalPaxPrice\":26434.0,\"totalSSRPrice\":0.0,\"totalTax\":4074.0,\"totalAmount\":26434.0,\"totalBaseFare\":22360.0,\"pointsBalanceDue\":0,\"CashUsed\":0.0,\"CashEquilant\":0.0,\"refundAmount\":0.0,\"refundPoint\":0.0},\"paxFares\":[{\"fareDiscountCode\":null,\"passengerDiscountCode\":null,\"passengerType\":\"ADT\",\"fareAmount\":13217.0,\"serviceCharges\":[{\"amount\":11180.0,\"detail\":null,\"code\":null,\"currencyCode\":\"INR\",\"points\":0,\"type\":0},{\"amount\":433.0,\"detail\":\"CPH-GVA\",\"code\":\"G1\",\"currencyCode\":\"INR\",\"points\":0,\"type\":4},{\"amount\":22.0,\"detail\":\"CPH-GVA\",\"code\":\"H8\",\"currencyCode\":\"INR\",\"points\":0,\"type\":4},{\"amount\":1582.0,\"detail\":\"CPH-GVA\",\"code\":\"MY\",\"currencyCode\":\"INR\",\"points\":0,\"type\":4}],\"multiplier\":2,\"points\":0}],\"taxAmountList\":[{\"feeCode\":\"G1\",\"feeName\":\"CPH-GVA\",\"feeCodeName\":\"MY: Departure Levy Tax\",\"value\":866.0,\"type\":4,\"currencyType\":null},{\"feeCode\":\"H8\",\"feeName\":\"CPH-GVA\",\"feeCodeName\":\"MAVCOM Regulatory Service Fee\",\"value\":44.0,\"type\":4,\"currencyType\":null},{\"feeCode\":\"MY\",\"feeName\":\"CPH-GVA\",\"feeCodeName\":\"Malaysian Passenger Service Fee (PSC)\",\"value\":3164.0,\"type\":4,\"currencyType\":null}],\"ssrAmountList\":[],\"passengerCount\":2,\"airfareCharges\":22360.0,\"pointsBalanceDue\":null}],\"refundList\":null},\"passengers\":[{\"passengerKey\":\"MCFBRFQ-\",\"services\":null,\"specialServices\":null,\"upgrades\":null,\"spoilage\":null,\"nameChanges\":null,\"convenience\":null,\"infant\":null,\"passengerAlternateKey\":null,\"ExtraSeatTag\":null,\"name\":{\"first\":\"Test\",\"middle\":null,\"last\":\"Test\",\"title\":\"MR\",\"suffix\":null},\"passengerTypeCode\":\"ADT\",\"discountCode\":null,\"bags\":null,\"info\":{\"nationality\":null,\"gender\":1,\"dateOfBirth\":null},\"travelDocuments\":null,\"eTicketNumber\":\"hf876876sagd\",\"seatsAndSsrs\":{\"journeys\":[{\"designator\":{\"destination\":\"CPH\",\"origin\":\"BCN\",\"arrival\":\"2026-01-01T19:30:00\",\"departure\":\"2025-12-31T21:30:00\"},\"segments\":[{\"segmentDetails\":{\"destination\":\"GVA\",\"origin\":\"BCN\",\"arrival\":\"2026-01-01T00:25:00\",\"departure\":\"2025-12-31T21:30:00\",\"utcarrival\":\"2025-12-31T18:55:00Z\",\"utcdeparture\":\"2025-12-31T16:00:00Z\",\"identifier\":{\"identifier\":\"477\",\"carrierCode\":\"6E\",\"opSuffix\":null},\"destinationName\":\"Kempegowda International Airport\",\"originName\":\"Indira Gandhi International Airport\",\"originCityName\":\"Delhi\",\"destinationCityName\":\"Kuala Lumpur\",\"isCodeShareMealMsgRequired\":null},\"segmentKey\":\"NkV_IDQ3N34gfn5ERUx_MTIvMzEvMjAyNSAyMTozMH5CTFJ_MDEvMDEvMjAyNiAwMDoyNX5_\",\"legs\":[{\"legKey\":\"NjM5MDI4MTM0MDAwMDAwMDAwITZFITQ3NyEgIURFTCFCTFIhOTkyMTkyNw--\",\"legDetails\":null,\"designator\":{\"destination\":\"GVA\",\"origin\":\"BCN\",\"arrival\":\"2026-01-01T00:25:00\",\"departure\":\"2025-12-31T21:30:00\"},\"ssrs\":null}],\"designator\":{\"destination\":\"GVA\",\"origin\":\"BCN\",\"arrival\":\"2026-01-01T00:25:00\",\"departure\":\"2025-12-31T21:30:00\"},\"operatedByText\":null,\"isSeatmapViewable\":true,\"baggageAllowanceWeight\":0,\"baggageAllowanceUsed\":null,\"baggageAllowanceWeightType\":null,\"boardingSequence\":null,\"barcodestring\":\"M1Test/Test            DELBLR6E 0000 365Y000Y00000 009\",\"liftStatus\":\"Default\",\"hasInfant\":false,\"tickets\":null,\"bundleCode\":null,\"isToShowOTB\":false,\"okToBoardValue\":false,\"seats\":[],\"ssrs\":[],\"seatmapReference\":null,\"externalIdentifier\":null,\"international\":false,\"passengerSegment\":null,\"productClass\":null},{\"segmentDetails\":{\"destination\":\"CPH\",\"origin\":\"GVA\",\"arrival\":\"2026-01-01T19:30:00\",\"departure\":\"2026-01-01T12:30:00\",\"utcarrival\":\"2026-01-01T11:30:00Z\",\"utcdeparture\":\"2026-01-01T07:00:00Z\",\"identifier\":{\"identifier\":\"1037\",\"carrierCode\":\"6E\",\"opSuffix\":null},\"destinationName\":\"Kuala Lumpur International Airport\",\"originName\":\"Kempegowda International Airport\",\"originCityName\":\"Delhi\",\"destinationCityName\":\"Kuala Lumpur\",\"isCodeShareMealMsgRequired\":null},\"segmentKey\":\"NkV_MTAzN34gfn5CTFJ_MDEvMDEvMjAyNiAxMjozMH5LVUx_MDEvMDEvMjAyNiAxOTozMH5_\",\"legs\":[{\"legKey\":\"NjM5MDI4Njc0MDAwMDAwMDAwITZFITEwMzchICFCTFIhS1VMITEwMzYwMjIw\",\"legDetails\":null,\"designator\":{\"destination\":\"CPH\",\"origin\":\"GVA\",\"arrival\":\"2026-01-01T19:30:00\",\"departure\":\"2026-01-01T12:30:00\"},\"ssrs\":null}],\"designator\":{\"destination\":\"CPH\",\"origin\":\"GVA\",\"arrival\":\"2026-01-01T19:30:00\",\"departure\":\"2026-01-01T12:30:00\"},\"operatedByText\":null,\"isSeatmapViewable\":true,\"baggageAllowanceWeight\":0,\"baggageAllowanceUsed\":null,\"baggageAllowanceWeightType\":null,\"boardingSequence\":null,\"barcodestring\":\"M1Test/Test            BLRKUL6E 0000 001Y000Y00000 009\",\"liftStatus\":\"Default\",\"hasInfant\":false,\"tickets\":null,\"bundleCode\":null,\"isToShowOTB\":false,\"okToBoardValue\":false,\"seats\":[],\"ssrs\":[],\"seatmapReference\":null,\"externalIdentifier\":null,\"international\":false,\"passengerSegment\":null,\"productClass\":null}],\"journeyKey\":\"NkV_IDQ3N34gfn5ERUx_MTIvMzEvMjAyNSAyMTozMH5CTFJ_MDEvMDEvMjAyNiAwMDoyNX5_XjZFfjEwMzd_IH5_QkxSfjAxLzAxLzIwMjYgMTI6MzB_S1VMfjAxLzAxLzIwMjYgMTk6MzB_fg--\"},{\"designator\":{\"destination\":\"GVA\",\"origin\":\"CPH\",\"arrival\":\"2026-01-06T23:00:00\",\"departure\":\"2026-01-06T21:20:00\"},\"segments\":[{\"segmentDetails\":{\"destination\":\"GVA\",\"origin\":\"CPH\",\"arrival\":\"2026-01-06T23:00:00\",\"departure\":\"2026-01-06T21:20:00\",\"utcarrival\":\"2026-01-06T17:30:00Z\",\"utcdeparture\":\"2026-01-06T13:20:00Z\",\"identifier\":{\"identifier\":\"1038\",\"carrierCode\":\"6E\",\"opSuffix\":null},\"destinationName\":\"Kempegowda International Airport\",\"originName\":\"Kuala Lumpur International Airport\",\"originCityName\":\"Kuala Lumpur\",\"destinationCityName\":\"Bengaluru\",\"isCodeShareMealMsgRequired\":null},\"segmentKey\":\"NkV_MTAzOH4gfn5LVUx_MDEvMDYvMjAyNiAyMToyMH5CTFJ_MDEvMDYvMjAyNiAyMzowMH5_\",\"legs\":[{\"legKey\":\"NjM5MDMzMzEyMDAwMDAwMDAwITZFITEwMzghICFLVUwhQkxSITEwMzYwMzc3\",\"legDetails\":null,\"designator\":{\"destination\":\"GVA\",\"origin\":\"CPH\",\"arrival\":\"2026-01-06T23:00:00\",\"departure\":\"2026-01-06T21:20:00\"},\"ssrs\":null}],\"designator\":{\"destination\":\"GVA\",\"origin\":\"CPH\",\"arrival\":\"2026-01-06T23:00:00\",\"departure\":\"2026-01-06T21:20:00\"},\"operatedByText\":null,\"isSeatmapViewable\":true,\"baggageAllowanceWeight\":0,\"baggageAllowanceUsed\":null,\"baggageAllowanceWeightType\":null,\"boardingSequence\":null,\"barcodestring\":\"M1Test/Test            KULBLR6E 0000 006Y000Y00000 009\",\"liftStatus\":\"Default\",\"hasInfant\":false,\"tickets\":null,\"bundleCode\":null,\"isToShowOTB\":false,\"okToBoardValue\":false,\"seats\":[],\"ssrs\":[],\"seatmapReference\":null,\"externalIdentifier\":null,\"international\":false,\"passengerSegment\":null,\"productClass\":null}],\"journeyKey\":\"NkV_MTAzOH4gfn5LVUx_MDEvMDYvMjAyNiAyMToyMH5CTFJ_MDEvMDYvMjAyNiAyMzowMH5_\"}]}},{\"passengerKey\":\"MSFBRFQ-\",\"services\":null,\"specialServices\":null,\"upgrades\":null,\"spoilage\":null,\"nameChanges\":null,\"convenience\":null,\"infant\":null,\"passengerAlternateKey\":null,\"ExtraSeatTag\":null,\"name\":{\"first\":\"TestA\",\"middle\":null,\"last\":\"TestA\",\"title\":\"MR\",\"suffix\":null},\"passengerTypeCode\":\"ADT\",\"discountCode\":null,\"bags\":null,\"info\":{\"nationality\":null,\"gender\":1,\"dateOfBirth\":null},\"travelDocuments\":null,\"eTicketNumber\":\"hf876876sagd\",\"seatsAndSsrs\":{\"journeys\":[{\"designator\":{\"destination\":\"CPH\",\"origin\":\"BCN\",\"arrival\":\"2026-01-01T19:30:00\",\"departure\":\"2025-12-31T21:30:00\"},\"segments\":[{\"segmentDetails\":{\"destination\":\"GVA\",\"origin\":\"BCN\",\"arrival\":\"2026-01-01T00:25:00\",\"departure\":\"2025-12-31T21:30:00\",\"utcarrival\":\"2025-12-31T18:55:00Z\",\"utcdeparture\":\"2025-12-31T16:00:00Z\",\"identifier\":{\"identifier\":\"477\",\"carrierCode\":\"6E\",\"opSuffix\":null},\"destinationName\":\"Kempegowda International Airport\",\"originName\":\"Indira Gandhi International Airport\",\"originCityName\":\"Delhi\",\"destinationCityName\":\"Kuala Lumpur\",\"isCodeShareMealMsgRequired\":null},\"segmentKey\":\"NkV_IDQ3N34gfn5ERUx_MTIvMzEvMjAyNSAyMTozMH5CTFJ_MDEvMDEvMjAyNiAwMDoyNX5_\",\"legs\":[{\"legKey\":\"NjM5MDI4MTM0MDAwMDAwMDAwITZFITQ3NyEgIURFTCFCTFIhOTkyMTkyNw--\",\"legDetails\":null,\"designator\":{\"destination\":\"GVA\",\"origin\":\"BCN\",\"arrival\":\"2026-01-01T00:25:00\",\"departure\":\"2025-12-31T21:30:00\"},\"ssrs\":null}],\"designator\":{\"destination\":\"GVA\",\"origin\":\"BCN\",\"arrival\":\"2026-01-01T00:25:00\",\"departure\":\"2025-12-31T21:30:00\"},\"operatedByText\":null,\"isSeatmapViewable\":true,\"baggageAllowanceWeight\":0,\"baggageAllowanceUsed\":null,\"baggageAllowanceWeightType\":null,\"boardingSequence\":null,\"barcodestring\":\"M1TestA/TestA          DELBLR6E 0000 365Y000Y00000 009\",\"liftStatus\":\"Default\",\"hasInfant\":false,\"tickets\":null,\"bundleCode\":null,\"isToShowOTB\":false,\"okToBoardValue\":false,\"seats\":[],\"ssrs\":[],\"seatmapReference\":null,\"externalIdentifier\":null,\"international\":false,\"passengerSegment\":null,\"productClass\":null},{\"segmentDetails\":{\"destination\":\"CPH\",\"origin\":\"GVA\",\"arrival\":\"2026-01-01T19:30:00\",\"departure\":\"2026-01-01T12:30:00\",\"utcarrival\":\"2026-01-01T11:30:00Z\",\"utcdeparture\":\"2026-01-01T07:00:00Z\",\"identifier\":{\"identifier\":\"1037\",\"carrierCode\":\"6E\",\"opSuffix\":null},\"destinationName\":\"Kuala Lumpur International Airport\",\"originName\":\"Kempegowda International Airport\",\"originCityName\":\"Delhi\",\"destinationCityName\":\"Kuala Lumpur\",\"isCodeShareMealMsgRequired\":null},\"segmentKey\":\"NkV_MTAzN34gfn5CTFJ_MDEvMDEvMjAyNiAxMjozMH5LVUx_MDEvMDEvMjAyNiAxOTozMH5_\",\"legs\":[{\"legKey\":\"NjM5MDI4Njc0MDAwMDAwMDAwITZFITEwMzchICFCTFIhS1VMITEwMzYwMjIw\",\"legDetails\":null,\"designator\":{\"destination\":\"CPH\",\"origin\":\"GVA\",\"arrival\":\"2026-01-01T19:30:00\",\"departure\":\"2026-01-01T12:30:00\"},\"ssrs\":null}],\"designator\":{\"destination\":\"CPH\",\"origin\":\"GVA\",\"arrival\":\"2026-01-01T19:30:00\",\"departure\":\"2026-01-01T12:30:00\"},\"operatedByText\":null,\"isSeatmapViewable\":true,\"baggageAllowanceWeight\":0,\"baggageAllowanceUsed\":null,\"baggageAllowanceWeightType\":null,\"boardingSequence\":null,\"barcodestring\":\"M1TestA/TestA          BLRKUL6E 0000 001Y000Y00000 009\",\"liftStatus\":\"Default\",\"hasInfant\":false,\"tickets\":null,\"bundleCode\":null,\"isToShowOTB\":false,\"okToBoardValue\":false,\"seats\":[],\"ssrs\":[],\"seatmapReference\":null,\"externalIdentifier\":null,\"international\":false,\"passengerSegment\":null,\"productClass\":null}],\"journeyKey\":\"NkV_IDQ3N34gfn5ERUx_MTIvMzEvMjAyNSAyMTozMH5CTFJ_MDEvMDEvMjAyNiAwMDoyNX5_XjZFfjEwMzd_IH5_QkxSfjAxLzAxLzIwMjYgMTI6MzB_S1VMfjAxLzAxLzIwMjYgMTk6MzB_fg--\"},{\"designator\":{\"destination\":\"GVA\",\"origin\":\"CPH\",\"arrival\":\"2026-01-06T23:00:00\",\"departure\":\"2026-01-06T21:20:00\"},\"segments\":[{\"segmentDetails\":{\"destination\":\"GVA\",\"origin\":\"CPH\",\"arrival\":\"2026-01-06T23:00:00\",\"departure\":\"2026-01-06T21:20:00\",\"utcarrival\":\"2026-01-06T17:30:00Z\",\"utcdeparture\":\"2026-01-06T13:20:00Z\",\"identifier\":{\"identifier\":\"1038\",\"carrierCode\":\"6E\",\"opSuffix\":null},\"destinationName\":\"Kempegowda International Airport\",\"originName\":\"Kuala Lumpur International Airport\",\"originCityName\":\"Kuala Lumpur\",\"destinationCityName\":\"Bengaluru\",\"isCodeShareMealMsgRequired\":null},\"segmentKey\":\"NkV_MTAzOH4gfn5LVUx_MDEvMDYvMjAyNiAyMToyMH5CTFJ_MDEvMDYvMjAyNiAyMzowMH5_\",\"legs\":[{\"legKey\":\"NjM5MDMzMzEyMDAwMDAwMDAwITZFITEwMzghICFLVUwhQkxSITEwMzYwMzc3\",\"legDetails\":null,\"designator\":{\"destination\":\"GVA\",\"origin\":\"CPH\",\"arrival\":\"2026-01-06T23:00:00\",\"departure\":\"2026-01-06T21:20:00\"},\"ssrs\":null}],\"designator\":{\"destination\":\"GVA\",\"origin\":\"CPH\",\"arrival\":\"2026-01-06T23:00:00\",\"departure\":\"2026-01-06T21:20:00\"},\"operatedByText\":null,\"isSeatmapViewable\":true,\"baggageAllowanceWeight\":0,\"baggageAllowanceUsed\":null,\"baggageAllowanceWeightType\":null,\"boardingSequence\":null,\"barcodestring\":\"M1TestA/TestA          KULBLR6E 0000 006Y000Y00000 009\",\"liftStatus\":\"Default\",\"hasInfant\":false,\"tickets\":null,\"bundleCode\":null,\"isToShowOTB\":false,\"okToBoardValue\":false,\"seats\":[],\"ssrs\":[],\"seatmapReference\":null,\"externalIdentifier\":null,\"international\":false,\"passengerSegment\":null,\"productClass\":null}],\"journeyKey\":\"NkV_MTAzOH4gfn5LVUx_MDEvMDYvMjAyNiAyMToyMH5CTFJ_MDEvMDYvMjAyNiAyMzowMH5_\"}]}}],\"extraSeatKeys\":[],\"configSettings\":{\"FareConfig\":[{\"fareType\":\"SAVER\",\"productClass\":\"R\",\"isMealIncluded\":false,\"isStandarSeatIncluded\":false,\"discountOnXLSeat\":50,\"dateChangecode\":\"D01\",\"cancelCode\":\"C01\",\"SSRsIncluded\":\"\",\"baggageCounts\":{\"checkinBaggage\":1,\"handBaggage\":1,\"doubleSeatAddedBaggage\":1,\"tripleSeatAddedBaggage\":1,\"PromoAddedBaggage\":0,\"doubleSeatAddedBaggag\":null,\"studentPromoAddedBaggage\":null},\"baggageWeights\":{\"handBaggage\":7,\"checkinBaggage\":30,\"DoubleSeatAddedBaggage\":10,\"TripleSeatAddedBaggae\":0,\"PromoAddedBaggae\":0,\"StudentPromoAddedBaggae\":null}},{\"fareType\":\"Coupon\",\"productClass\":\"C\",\"isMealIncluded\":true,\"isStandarSeatIncluded\":true,\"discountOnXLSeat\":50,\"dateChangecode\":\"D01\",\"cancelCode\":\"C01\",\"SSRsIncluded\":\"SEAT\",\"baggageCounts\":{\"checkinBaggage\":1,\"handBaggage\":1,\"doubleSeatAddedBaggage\":1,\"tripleSeatAddedBaggage\":1,\"PromoAddedBaggage\":0,\"doubleSeatAddedBaggag\":null,\"studentPromoAddedBaggage\":null},\"baggageWeights\":{\"handBaggage\":7,\"checkinBaggage\":30,\"DoubleSeatAddedBaggage\":10,\"TripleSeatAddedBaggae\":0,\"PromoAddedBaggae\":0,\"StudentPromoAddedBaggae\":null}},{\"fareType\":\"Tactical\",\"productClass\":\"T\",\"isMealIncluded\":false,\"isStandarSeatIncluded\":false,\"discountOnXLSeat\":50,\"dateChangecode\":\"D01\",\"cancelCode\":\"C01\",\"SSRsIncluded\":\"\",\"baggageCounts\":{\"checkinBaggage\":1,\"handBaggage\":1,\"doubleSeatAddedBaggage\":1,\"tripleSeatAddedBaggage\":1,\"PromoAddedBaggage\":0,\"doubleSeatAddedBaggag\":null,\"studentPromoAddedBaggage\":null},\"baggageWeights\":{\"handBaggage\":7,\"checkinBaggage\":30,\"DoubleSeatAddedBaggage\":10,\"TripleSeatAddedBaggae\":0,\"PromoAddedBaggae\":0,\"StudentPromoAddedBaggae\":null}},{\"fareType\":\"Corporate\",\"productClass\":\"F\",\"isMealIncluded\":true,\"isStandarSeatIncluded\":true,\"discountOnXLSeat\":50,\"dateChangecode\":\"D01\",\"cancelCode\":\"C01\",\"SSRsIncluded\":\"SEAT\",\"baggageCounts\":{\"checkinBaggage\":1,\"handBaggage\":1,\"doubleSeatAddedBaggage\":1,\"tripleSeatAddedBaggage\":1,\"PromoAddedBaggage\":0,\"doubleSeatAddedBaggag\":null,\"studentPromoAddedBaggage\":null},\"baggageWeights\":{\"handBaggage\":10,\"checkinBaggage\":30,\"DoubleSeatAddedBaggage\":10,\"TripleSeatAddedBaggae\":0,\"PromoAddedBaggae\":0,\"StudentPromoAddedBaggae\":null}},{\"fareType\":\"Sale\",\"productClass\":\"S\",\"isMealIncluded\":false,\"isStandarSeatIncluded\":false,\"discountOnXLSeat\":50,\"dateChangecode\":\"D01\",\"cancelCode\":\"C01\",\"SSRsIncluded\":\"\",\"baggageCounts\":{\"checkinBaggage\":1,\"handBaggage\":1,\"doubleSeatAddedBaggage\":1,\"tripleSeatAddedBaggage\":1,\"PromoAddedBaggage\":0,\"doubleSeatAddedBaggag\":null,\"studentPromoAddedBaggage\":null},\"baggageWeights\":{\"handBaggage\":7,\"checkinBaggage\":30,\"DoubleSeatAddedBaggage\":10,\"TripleSeatAddedBaggae\":0,\"PromoAddedBaggae\":0,\"StudentPromoAddedBaggae\":null}},{\"fareType\":\"Lite\",\"productClass\":\"B\",\"isMealIncluded\":false,\"isStandarSeatIncluded\":false,\"discountOnXLSeat\":50,\"dateChangecode\":\"D01\",\"cancelCode\":\"C01\",\"SSRsIncluded\":\"\",\"baggageCounts\":{\"checkinBaggage\":1,\"handBaggage\":1,\"doubleSeatAddedBaggage\":1,\"tripleSeatAddedBaggage\":1,\"PromoAddedBaggage\":0,\"doubleSeatAddedBaggag\":null,\"studentPromoAddedBaggage\":null},\"baggageWeights\":{\"handBaggage\":5,\"checkinBaggage\":30,\"DoubleSeatAddedBaggage\":10,\"TripleSeatAddedBaggae\":0,\"PromoAddedBaggae\":0,\"StudentPromoAddedBaggae\":null}},{\"fareType\":\"Return Special\",\"productClass\":\"N\",\"isMealIncluded\":false,\"isStandarSeatIncluded\":false,\"discountOnXLSeat\":50,\"dateChangecode\":\"D01\",\"cancelCode\":\"C01\",\"SSRsIncluded\":\"\",\"baggageCounts\":{\"checkinBaggage\":1,\"handBaggage\":1,\"doubleSeatAddedBaggage\":1,\"tripleSeatAddedBaggage\":1,\"PromoAddedBaggage\":0,\"doubleSeatAddedBaggag\":null,\"studentPromoAddedBaggage\":null},\"baggageWeights\":{\"handBaggage\":7,\"checkinBaggage\":30,\"DoubleSeatAddedBaggage\":10,\"TripleSeatAddedBaggae\":0,\"PromoAddedBaggae\":0,\"StudentPromoAddedBaggae\":null}},{\"fareType\":\"Family\",\"productClass\":\"A\",\"isMealIncluded\":false,\"isStandarSeatIncluded\":false,\"discountOnXLSeat\":50,\"dateChangecode\":\"D01\",\"cancelCode\":\"C01\",\"SSRsIncluded\":\"\",\"baggageCounts\":{\"checkinBaggage\":1,\"handBaggage\":1,\"doubleSeatAddedBaggage\":1,\"tripleSeatAddedBaggage\":1,\"PromoAddedBaggage\":0,\"doubleSeatAddedBaggag\":null,\"studentPromoAddedBaggage\":null},\"baggageWeights\":{\"handBaggage\":7,\"checkinBaggage\":30,\"DoubleSeatAddedBaggage\":10,\"TripleSeatAddedBaggae\":0,\"PromoAddedBaggae\":0,\"StudentPromoAddedBaggae\":null}},{\"fareType\":\"CAPF\",\"productClass\":\"G2\",\"isMealIncluded\":false,\"isStandarSeatIncluded\":false,\"discountOnXLSeat\":50,\"dateChangecode\":\"D01\",\"cancelCode\":\"C01\",\"SSRsIncluded\":\"\",\"baggageCounts\":{\"checkinBaggage\":1,\"handBaggage\":1,\"doubleSeatAddedBaggage\":1,\"tripleSeatAddedBaggage\":1,\"PromoAddedBaggage\":0,\"doubleSeatAddedBaggag\":null,\"studentPromoAddedBaggage\":null},\"baggageWeights\":{\"handBaggage\":7,\"checkinBaggage\":30,\"DoubleSeatAddedBaggage\":10,\"TripleSeatAddedBaggae\":0,\"PromoAddedBaggae\":0,\"StudentPromoAddedBaggae\":null}},{\"fareType\":\"Super 6E\",\"productClass\":\"O\",\"isMealIncluded\":true,\"isStandarSeatIncluded\":true,\"discountOnXLSeat\":50,\"dateChangecode\":\"D01\",\"cancelCode\":\"C01\",\"SSRsIncluded\":\"SEAT,FFWD,PRBG\",\"baggageCounts\":{\"checkinBaggage\":1,\"handBaggage\":1,\"doubleSeatAddedBaggage\":1,\"tripleSeatAddedBaggage\":1,\"PromoAddedBaggage\":0,\"doubleSeatAddedBaggag\":null,\"studentPromoAddedBaggage\":null},\"baggageWeights\":{\"handBaggage\":7,\"checkinBaggage\":30,\"DoubleSeatAddedBaggage\":10,\"TripleSeatAddedBaggae\":0,\"PromoAddedBaggae\":0,\"StudentPromoAddedBaggae\":null}},{\"fareType\":\"Corp Connect\",\"productClass\":\"M\",\"isMealIncluded\":false,\"isStandarSeatIncluded\":true,\"discountOnXLSeat\":50,\"dateChangecode\":\"D01\",\"cancelCode\":\"C01\",\"SSRsIncluded\":\"SEAT\",\"baggageCounts\":{\"checkinBaggage\":1,\"handBaggage\":1,\"doubleSeatAddedBaggage\":1,\"tripleSeatAddedBaggage\":1,\"PromoAddedBaggage\":0,\"doubleSeatAddedBaggag\":null,\"studentPromoAddedBaggage\":null},\"baggageWeights\":{\"handBaggage\":7,\"checkinBaggage\":30,\"DoubleSeatAddedBaggage\":10,\"TripleSeatAddedBaggae\":0,\"PromoAddedBaggae\":0,\"StudentPromoAddedBaggae\":null}},{\"fareType\":\"Flexi\",\"productClass\":\"J\",\"isMealIncluded\":true,\"isStandarSeatIncluded\":true,\"discountOnXLSeat\":50,\"dateChangecode\":\"D01\",\"cancelCode\":\"C01\",\"SSRsIncluded\":\"SEAT\",\"baggageCounts\":{\"checkinBaggage\":1,\"handBaggage\":1,\"doubleSeatAddedBaggage\":1,\"tripleSeatAddedBaggage\":1,\"PromoAddedBaggage\":0,\"doubleSeatAddedBaggag\":null,\"studentPromoAddedBaggage\":null},\"baggageWeights\":{\"handBaggage\":7,\"checkinBaggage\":30,\"DoubleSeatAddedBaggage\":10,\"TripleSeatAddedBaggae\":0,\"PromoAddedBaggae\":0,\"StudentPromoAddedBaggae\":null}}]}},\"agentCode\":null,\"agentCountryCode\":null}"

        
        // Define IFG/BSP specific metadata based on scenario
        const isInternational = scenario.label.toLowerCase().includes("int");
        const isModification = scenario.id.includes("mod");

        // Merchant View URL updated for AI Express
        const merchantViewUrl = `${protocol}://${host}/merchant-view?fromCity=Delhi&toCity=Mumbai&fromCode=DEL&toCode=BOM&date=2026-02-15&depTime=23:30&arrTime=01:55&duration=02h+25m&flightNo=IX+519&pax=1&baggageCheckin=15&baggageHand=7`;

        const payload = {
            "order_id": `AIX-IFG-${Date.now()}`,
            "amount": scenario.amount,
            "currency": scenario.currency,
            "customer_id": "IFG_DEMO_USER",
            "customer_email": "bsp-test@airindiaexpress.in",
            "customer_phone": "9999999999",
            "mobile_country_code": "91",
            "payment_page_client_id": "airindiademo",
            "action": "paymentPage",
            "return_url": `${protocol}://${host}/?status=success&scenario=${scenario.id}`,
            "merchant_view_url": merchantViewUrl,
            "metadata.JUSPAY:gateway_reference_id": "FLIGHT",
            "udf3": "RCTT",
            "udf4": "Arora",
            "udf10": "IFG_DEMO_V1",
            "metadata.NAVITAIRE:session_expiry_in_sec": "900",
            "disable_merchant_integrity_check": true,
            "options.get_client_auth_token": true,
            "payment_filter": {
                "options": [
                    { "enable": "true", "paymentMethodType": "CARD" },
                    { "enable": "true", "paymentMethodType": "UPI" },
                    {
                        "enable": "true",
                        "paymentMethodType": "MERCHANT_CONTAINER",
                        "paymentMethods": ["BSP", "HOLD_AND_PAY", "NAV_AGENT_WALLET"]
                    }
                ],
                "allowDefaultOptions": true
            },
            "merchant_transient_info": mti,
            "metadata.webhook_url": "https://api-uat-skyplus.goindigo.in/postpayment/v1/payment/webhook",
            "metadata.expiryInMins": "15"
        };

        const response = await axios.post('https://sandbox.juspay.in/session', payload, {
            headers: { 
                'Authorization': JUSPAY_AUTH, 
                'Content-Type': 'application/json' 
            }
        });

        res.json({ url: response.data.payment_links.web });
    } catch (error) {
        console.error("âŒ IFG SESSION ERROR:", error.response?.data || error.message);
        res.status(500).json({ error: "IFG Session Creation Failed" });
    }
});

app.get('/merchant-view', (req, res) => {
    // Basic placeholder for the merchant summary view
    res.send(`
        <div style="font-family: sans-serif; padding: 20px; color: #333;">
            <h2 style="color: #E31837;">Booking Summary</h2>
            <p><strong>Flight:</strong> ${req.query.fromCode} to ${req.query.toCode}</p>
            <p><strong>Passenger:</strong> ${req.query.pax} Adult</p>
            <hr/>
            <p>Redirecting to secure IATA payment gateway...</p>
        </div>
    `);
});

const PORT = process.env.PORT || 3001;
app.listen(PORT, () => console.log(`ðŸš€ Air India Express IFG Demo running on port ${PORT}`));